{% extends 'jobia/base_no_nav.html' %}
{% load static compress cache %}
{% block title %}Gerar Currículo{% endblock %}
{% block extra_css %}
    {% compress css %}
        <link rel="stylesheet" href="{% static 'css/new_curriculum.css' %}" />
    {% endcompress %}
{% endblock %}
{% block content %}
    <div id="startCard" class="start-card">
        <h2>Gerar Novo Currículo</h2>
        <p>
            Vamos te guiar através de um questionário. Este processo levará aproximadamente 5 minutos. A partir daqui não cancele a geração do currículo, nem saia da página.
        </p>
        <div class="btn-group">
            <button id="cancelBtn"
                    class="btn btn-secondary"
                    onclick="window.location.href='{% url 'dashboard' %}'">Cancelar</button>
            <button id="startBtn" class="btn btn-primary">Iniciar</button>
        </div>
    </div>
    <div id="curriculumModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <img src="{% static 'imgs/logo4.png' %}"
                     alt="JobAI Logo"
                     class="modal-logo" />
                <h2>Currículo {{ request.user.subscription.plan.name }}</h2>
                <span class="subtitle">Preencha os campos abaixo para gerar seu currículo</span>
            </div>
            {% with plan=request.user.subscription.plan.name %}
                {% if plan == 'Essencial' %}
                    <form id="curriculumForm" class="modal-form">
                        <div class="form-group">
                            <label for="fullName">Qual é o seu nome completo?</label>
                            <input type="text" id="fullName" name="fullName" required />
                        </div>
                        <div class="form-group">
                            <label for="desiredPosition">Qual cargo deseja ocupar?</label>
                            <input type="text" id="desiredPosition" name="desiredPosition" required />
                        </div>
                        <div class="form-group">
                            <label for="professionalGoal">Qual é o seu objetivo profissional?</label>
                            <textarea id="professionalGoal" name="professionalGoal" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="education">Qual é a sua formação acadêmica?</label>
                            <textarea id="education" name="education" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="skills">Liste 5 habilidades suas</label>
                            <textarea id="skills" name="skills" rows="5" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="experience">Descreva suas experiências profissionais</label>
                            <textarea id="experience" name="experience" rows="5" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="email">Qual é o seu email?</label>
                            <input type="email" id="email" name="email" required />
                        </div>
                        <div class="form-group">
                            <label for="contact">Qual é o seu contacto?</label>
                            <input type="tel" id="contact" name="contact" required />
                        </div>
                        <div class="form-group">
                            <label for="address">Qual é o seu endereço?</label>
                            <input type="text" id="address" name="address" required />
                        </div>
                        <div class="form-actions">
                            <button type="button" id="backBtn" class="btn btn-secondary">Voltar</button>
                            <button type="submit" class="btn btn-primary">Gerar Currículo</button>
                        </div>
                    </form>
                {% elif plan == 'Profissional' %}
                    <form id="curriculumForm" class="modal-form">
                        <div class="form-section">
                            <div class="form-group">
                                <label for="fullName">Qual é o seu nome completo?</label>
                                <input type="text" id="fullName" name="fullName" required />
                            </div>
                            <div class="form-group">
                                <label for="profileTitle">Título profissional</label>
                                <input type="text"
                                       id="profileTitle"
                                       name="profileTitle"
                                       placeholder="Ex: Desenvolvedor Full Stack, Gerente de Marketing"
                                       required />
                            </div>
                            <div class="form-group">
                                <label for="birthDate">Data de nascimento</label>
                                <input type="date" id="birthDate" name="birthDate" />
                            </div>
                            <div class="form-group">
                                <label for="linkedin">LinkedIn</label>
                                <input type="url"
                                       id="linkedin"
                                       name="linkedin"
                                       placeholder="https://linkedin.com/in/seu-perfil" />
                            </div>
                            <div class="form-group">
                                <label for="portfolio">Site ou Portfólio</label>
                                <input type="url"
                                       id="portfolio"
                                       name="portfolio"
                                       placeholder="https://seusite.com" />
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="desiredPosition">Qual cargo deseja ocupar?</label>
                                <input type="text" id="desiredPosition" name="desiredPosition" required />
                            </div>
                            <div class="form-group">
                                <label for="professionalGoal">Qual é o seu objetivo profissional? (resumo em até 200 palavras)</label>
                                <textarea id="professionalGoal" name="professionalGoal" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="careerAspiration">Expectativas de carreira a longo prazo</label>
                                <textarea id="careerAspiration" name="careerAspiration" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="education">Liste sua formação acadêmica (inclua instituição, curso, período e status)</label>
                                <textarea id="education"
                                          name="education"
                                          rows="4"
                                          placeholder="Ex: Universidade Federal do Rio de Janeiro - Ciência da Computação - 2018-2022 - Concluído"
                                          required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="additionalEducation">Formação complementar (cursos, certificações, etc.)</label>
                                <textarea id="additionalEducation" name="additionalEducation" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="experience">Descreva suas experiências profissionais (empresa, cargo, período e responsabilidades)</label>
                                <textarea id="experience"
                                          name="experience"
                                          rows="6"
                                          placeholder="Ex: Empresa XYZ - Desenvolvedor Front-end - Janeiro 2020 a Dezembro 2022 - Responsável pelo desenvolvimento de interfaces..."
                                          required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="achievements">Principais conquistas e resultados</label>
                                <textarea id="achievements"
                                          name="achievements"
                                          rows="3"
                                          placeholder="Ex: Liderou projeto que aumentou conversão em 30%, implementou sistema que reduziu custos em 25%..."></textarea>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="hardSkills">Habilidades técnicas (liste até 10)</label>
                                <textarea id="hardSkills"
                                          name="hardSkills"
                                          rows="3"
                                          placeholder="Ex: Python, JavaScript, SQL, Excel avançado, Photoshop..."
                                          required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="softSkills">Habilidades comportamentais (liste até 5)</label>
                                <textarea id="softSkills"
                                          name="softSkills"
                                          rows="2"
                                          placeholder="Ex: Liderança, trabalho em equipe, comunicação eficaz..."
                                          required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="languages">Idiomas</label>
                                <textarea id="languages"
                                          name="languages"
                                          rows="2"
                                          placeholder="Ex: Inglês - Avançado, Espanhol - Intermediário..."></textarea>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" required />
                            </div>
                            <div class="form-group">
                                <label for="phone">Telefone</label>
                                <input type="tel" id="phone" name="phone" required />
                            </div>
                            <div class="form-group">
                                <label for="address">Endereço</label>
                                <input type="text" id="address" name="address" required />
                            </div>
                            <div class="form-group">
                                <label for="city">Cidade/Estado</label>
                                <input type="text" id="city" name="city" required />
                            </div>
                        </div>
                        <!-- Ações do formulário -->
                        <div class="form-actions">
                            <button type="button" id="backBtn" class="btn btn-secondary">Voltar</button>
                            <button type="submit" class="btn btn-primary">Gerar Currículo</button>
                        </div>
                    </form>
                {% elif plan == 'Executivo' %}
                    <form id="curriculumForm" class="modal-form">
                        <div class="form-section">
                            <div class="form-group">
                                <label for="fullName">Nome completo</label>
                                <input type="text" id="fullName" name="fullName" required />
                            </div>
                            <div class="form-group">
                                <label for="executiveTitle">Título executivo</label>
                                <input type="text"
                                       id="executiveTitle"
                                       name="executiveTitle"
                                       placeholder="Ex: Diretor Comercial, CFO, VP de Operações"
                                       required />
                            </div>
                            <div class="form-group">
                                <label for="profileSummary">Resumo do perfil executivo (até 300 palavras)</label>
                                <textarea id="profileSummary"
                                          name="profileSummary"
                                          rows="4"
                                          placeholder="Resumo poderoso destacando seus diferenciais como executivo..."
                                          required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="industryExpertise">Setores de especialização</label>
                                <input type="text"
                                       id="industryExpertise"
                                       name="industryExpertise"
                                       placeholder="Ex: Tecnologia, Finanças, Varejo"
                                       required />
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="email">Email profissional</label>
                                <input type="email" id="email" name="email" required />
                            </div>
                            <div class="form-group">
                                <label for="phone">Telefone</label>
                                <input type="tel" id="phone" name="phone" required />
                            </div>
                            <div class="form-group">
                                <label for="address">Localização</label>
                                <input type="text"
                                       id="address"
                                       name="address"
                                       placeholder="Cidade, Estado, País"
                                       required />
                            </div>
                            <div class="form-group">
                                <label for="linkedin">LinkedIn</label>
                                <input type="url"
                                       id="linkedin"
                                       name="linkedin"
                                       placeholder="https://linkedin.com/in/seu-perfil"
                                       required />
                            </div>
                            <div class="form-group">
                                <label for="personalWebsite">Website pessoal ou profissional</label>
                                <input type="url"
                                       id="personalWebsite"
                                       name="personalWebsite"
                                       placeholder="https://seusite.com" />
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="careerObjective">Qual posição executiva você almeja?</label>
                                <input type="text" id="careerObjective" name="careerObjective" required />
                            </div>
                            <div class="form-group">
                                <label for="careerVision">Visão de carreira para os próximos 3-5 anos</label>
                                <textarea id="careerVision" name="careerVision" rows="3" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="desiredCompanyProfile">Perfil de empresa desejado</label>
                                <textarea id="desiredCompanyProfile"
                                          name="desiredCompanyProfile"
                                          rows="2"
                                          placeholder="Ex: Empresa de médio/grande porte, startup em fase de escala, multinacional do setor de..."></textarea>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="executiveExperience">Detalhes das experiências executivas (para cada posição relevante)</label>
                                <textarea id="executiveExperience"
                                          name="executiveExperience"
                                          rows="8"
                                          placeholder="Para cada cargo executivo que ocupou, liste: - Empresa e setor - Cargo e período - Escopo de responsabilidade (orçamento, equipe, regiões) - Principais desafios enfrentados e como os superou - Principais conquistas quantificadas"
                                          required></textarea>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="keyAchievements">Principais conquistas quantificadas</label>
                                <textarea id="keyAchievements"
                                          name="keyAchievements"
                                          rows="5"
                                          placeholder="Liste 5-7 conquistas de alto impacto com números e percentuais. Ex: - Liderou transformação digital que reduziu custos operacionais em 35% - Aumentou receita anual de $10M para $25M em 3 anos - Expandiu operações para 3 novos mercados internacionais"
                                          required></textarea>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="leadershipStyle">Estilo de liderança e gestão de equipes</label>
                                <textarea id="leadershipStyle" name="leadershipStyle" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="teamManagement">Experiência em gestão de equipes</label>
                                <textarea id="teamManagement"
                                          name="teamManagement"
                                          rows="3"
                                          placeholder="Tamanho das equipes lideradas, abordagem de desenvolvimento de talentos, exemplos de resultados obtidos com sua liderança..."></textarea>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="education">Formação acadêmica</label>
                                <textarea id="education"
                                          name="education"
                                          rows="3"
                                          placeholder="Lista em ordem cronológica inversa, incluindo: - Instituição, curso, período - Especializações e MBAs - Honras e reconhecimentos acadêmicos"
                                          required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="executiveCertifications">Certificações executivas e de liderança</label>
                                <textarea id="executiveCertifications" name="executiveCertifications" rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="boardPositions">Participação em conselhos ou comitês</label>
                                <textarea id="boardPositions" name="boardPositions" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="hardSkills">Competências técnicas de gestão</label>
                                <textarea id="hardSkills"
                                          name="hardSkills"
                                          rows="3"
                                          placeholder="Ex: Planejamento estratégico, gestão financeira, fusões e aquisições, turnaround empresarial..."
                                          required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="softSkills">Competências comportamentais executivas</label>
                                <textarea id="softSkills"
                                          name="softSkills"
                                          rows="3"
                                          placeholder="Ex: Visão estratégica, tomada de decisão, negociação de alto nível, gestão de crises..."
                                          required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="languages">Idiomas e nível de proficiência</label>
                                <textarea id="languages" name="languages" rows="2" required></textarea>
                            </div>
                        </div>
                        <div class="form-section">
                            <div class="form-group">
                                <label for="publications">Publicações, palestras ou conferências</label>
                                <textarea id="publications"
                                          name="publications"
                                          rows="3"
                                          placeholder="Ex: Artigos publicados, participação como palestrante em eventos do setor, entrevistas concedidas..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="awards">Prêmios e reconhecimentos profissionais</label>
                                <textarea id="awards" name="awards" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" id="backBtn" class="btn btn-secondary">Voltar</button>
                            <button type="submit" class="btn btn-primary">Gerar Currículo</button>
                        </div>
                    </form>
                {% elif plan == 'Elite' %}
                    <form id="curriculumForm" class="modal-form">
                        <div class="form-step active" data-step="1">
                            <div class="form-section elite-section">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="fullName">Nome Completo*</label>
                                        <input type="text"
                                               id="fullName"
                                               name="fullName"
                                               required
                                               class="elite-input" />
                                    </div>
                                    <div class="form-group">
                                        <label for="professionalBrand">Marca Pessoal/Title*</label>
                                        <input type="text"
                                               id="professionalBrand"
                                               name="professionalBrand"
                                               required
                                               class="elite-input" />
                                        <small>Ex: "CEO | Transformação Digital | Growth Expert"</small>
                                    </div>
                                </div>
                                <div class="form-row triple">
                                    <div class="form-group">
                                        <label for="email">Email Profissional*</label>
                                        <input type="email" id="email" name="email" required class="elite-input" />
                                    </div>
                                    <div class="form-group">
                                        <label for="phone">Telefone*</label>
                                        <input type="tel" id="phone" name="phone" required class="elite-input" />
                                    </div>
                                    <div class="form-group">
                                        <label for="location">Localização*</label>
                                        <input type="text"
                                               id="location"
                                               name="location"
                                               required
                                               class="elite-input" />
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="linkedin">LinkedIn*</label>
                                        <input type="url" id="linkedin" name="linkedin" required class="elite-input" />
                                    </div>
                                    <div class="form-group">
                                        <label for="personalWebsite">Website/Portfólio</label>
                                        <input type="url"
                                               id="personalWebsite"
                                               name="personalWebsite"
                                               class="elite-input" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="personalStatement">Declaração Pessoal (30 palavras max)*</label>
                                    <textarea id="personalStatement"
                                              name="personalStatement"
                                              rows="2"
                                              maxlength="150"
                                              required
                                              class="elite-textarea"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="form-step" data-step="2">
                            <div class="form-section elite-section">
                                <div class="form-group">
                                    <label for="executiveSummary">Resumo de Carreira (150-200 palavras)*</label>
                                    <textarea id="executiveSummary"
                                              name="executiveSummary"
                                              rows="6"
                                              required
                                              class="elite-textarea"></textarea>
                                    <small>Destaque anos de experiência, setores, especialidades e visão estratégica</small>
                                </div>
                            </div>
                            <div class="form-section elite-section">
                                <div class="form-group">
                                    <label>Selecione suas principais expertises (3-5)*</label>
                                    <div class="expertise-tags-container">
                                        <input type="text"
                                               id="expertiseInput"
                                               class="elite-input"
                                               placeholder="Digite e pressione Enter" />
                                        <div id="expertiseTags"></div>
                                    </div>
                                    <small>Ex: Transformação Digital, Fusões & Aquisições, Turnaround Empresarial</small>
                                </div>
                            </div>
                            <div class="form-section elite-section">
                                <div class="form-group">
                                    <label for="leadershipPhilosophy">Filosofia de Liderança (opcional)</label>
                                    <textarea id="leadershipPhilosophy"
                                              name="leadershipPhilosophy"
                                              rows="3"
                                              class="elite-textarea"></textarea>
                                </div>
                            </div>
                            <div class="form-step" data-step="3">
                                <div class="form-section elite-section">
                                    <div id="eliteExperienceContainer">
                                        <div class="elite-experience-entry">
                                            <div class="form-row">
                                                <div class="form-group">
                                                    <label for="eliteCompany1">Empresa*</label>
                                                    <input type="text"
                                                           id="eliteCompany1"
                                                           name="eliteCompany[]"
                                                           required
                                                           class="elite-input" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="elitePosition1">Cargo*</label>
                                                    <input type="text"
                                                           id="elitePosition1"
                                                           name="elitePosition[]"
                                                           required
                                                           class="elite-input" />
                                                </div>
                                            </div>
                                            <div class="form-row triple">
                                                <div class="form-group">
                                                    <label for="eliteStart1">Início*</label>
                                                    <input type="month"
                                                           id="eliteStart1"
                                                           name="eliteStart[]"
                                                           required
                                                           class="elite-input" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="eliteEnd1">Término</label>
                                                    <input type="month" id="eliteEnd1" name="eliteEnd[]" class="elite-input" />
                                                </div>
                                                <div class="form-group">
                                                    <label for="eliteLocation1">Localização</label>
                                                    <input type="text"
                                                           id="eliteLocation1"
                                                           name="eliteLocation[]"
                                                           class="elite-input" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="eliteScope1">Escopo da Posição*</label>
                                                <textarea id="eliteScope1"
                                                          name="eliteScope[]"
                                                          rows="2"
                                                          required
                                                          class="elite-textarea"></textarea>
                                                <small>Ex: "Liderar equipe global de 150+ profissionais em 5 países"</small>
                                            </div>
                                            <div class="form-group">
                                                <label for="eliteAchievements1">Principais Realizações*</label>
                                                <div class="achievement-container">
                                                    <div class="achievement-entry">
                                                        <input type="text"
                                                               name="eliteAchievements[]"
                                                               required
                                                               class="elite-input achievement-input"
                                                               placeholder="Descreva uma realização com métricas" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="eliteAchievements12">Experiências</label>
                                                <div class="achievement-container">
                                                    <div class="achievement-entry">
                                                        <textarea name="" id="eliteAchievements12"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="eliteChallenges1">Desafios Superados (opcional)</label>
                                                <textarea id="eliteChallenges1"
                                                          name="eliteChallenges[]"
                                                          rows="2"
                                                          class="elite-textarea"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-step" data-step="4">
                                <div class="form-group">
                                    <label for="eliteAchievements13">Formação Acadêmica</label>
                                    <div class="achievement-container">
                                        <div class="achievement-entry">
                                            <textarea name="" id="eliteAchievements13"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="eliteChallenges1">Certificações Globais</label>
                                <textarea id="eliteChallenges1"
                                          name="eliteChallenges[]"
                                          rows="2"
                                          class="elite-textarea"></textarea>
                            </div>
                            <div class="form-step" data-step="5">
                                <div class="form-group">
                                    <label for="eliteChallenges1">Idiomas</label>
                                    <textarea id="eliteChallenges1"
                                              name="eliteChallenges[]"
                                              rows="2"
                                              class="elite-textarea"></textarea>
                                </div>
                                <div class="form-section elite-section">
                                    <div class="form-group">
                                        <label for="publications">Publicações Relevantes</label>
                                        <textarea id="publications" name="publications" rows="3" class="elite-textarea"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="mediaAppearances">Aparições na Mídia</label>
                                        <textarea id="mediaAppearances"
                                                  name="mediaAppearances"
                                                  rows="3"
                                                  class="elite-textarea"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="eliteChallenges1">Prêmios e Reconhecimentos</label>
                                    <textarea id="eliteChallenges1"
                                              name="eliteChallenges[]"
                                              rows="2"
                                              class="elite-textarea"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="eliteChallenges1">Atividades Filantrópicas</label>
                                    <textarea id="eliteChallenges1"
                                              name="eliteChallenges[]"
                                              rows="2"
                                              class="elite-textarea"></textarea>
                                </div>
                                <div class="form-actions">
                                    <button type="button" id="backBtn" class="btn btn-secondary">Voltar</button>
                                    <button type="submit" class="btn btn-primary">Gerar Currículo</button>
                                </div>
                            </div>
                        </form>
                    {% endif %}
                {% endwith %}
            </div>
        </div>
    {% endblock %}
    {% block extra_js %}
        <script>
    const curriculumRawData = {
      userId: parseInt('{{ request.user.id }}'),
      questions: []
    }
    
    document.addEventListener('DOMContentLoaded', function () {
      const startCard = document.getElementById('startCard')
      const startBtn = document.getElementById('startBtn')
      const modal = document.getElementById('curriculumModal')
      const backBtn = document.getElementById('backBtn')
      const form = document.getElementById('curriculumForm')
    
      startBtn.addEventListener('click', function () {
        startCard.style.display = 'none'
        modal.style.display = 'flex'
      })
    
      backBtn.addEventListener('click', function () {
        modal.style.display = 'none'
        startCard.style.display = 'flex'
      })
    
      form.addEventListener('submit', function (e) {
        e.preventDefault()
    
        const submitBtn = form.querySelector('button[type="submit"]')
        const originalText = submitBtn.textContent
    
        submitBtn.disabled = true
        submitBtn.textContent = 'Gerando...'
    
        document.querySelectorAll('.form-group').forEach((formGroup) => {
          const label = formGroup.querySelector('label').textContent
          const input = formGroup.querySelector('input') || formGroup.querySelector('textarea')
    
          curriculumRawData.questions.push({
            question: label,
            answer: input.value
          })
        })
    
        fetch('/curriculum/get-form-data/', {
          method: 'POST',
          body: JSON.stringify(curriculumRawData),
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
          }
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error('Falha ao enviar formulário')
            } else {
              return response.json()
            }
          })
          .then((data) => {
            const slug = data.slug
    
            modal.style.display = 'none'
            startCard.style.display = 'flex'
    
            const btnGroup = document.querySelector('.btn-group')
    
            if (btnGroup) {
              btnGroup.style.display = 'flex'
              btnGroup.style.justifyContent = 'center'
              btnGroup.style.alignItems = 'center'
              btnGroup.style.flexDirection = 'column'
              btnGroup.innerHTML = '<div class="loader"></div><span class="textloader">Gerando currículo</span>'
            }
    
            const textloader = document.querySelector('.textloader')
    
            fetch(`/curriculum/generate/${slug}/`, {
              method: 'GET',
              headers: {
                'Content-Type': 'application/json'
              }
            })
              .then((response) => {
                textloader.innerText = 'Organizando o currículo'
    
                if (!response.ok) {
                  return response.json().then((err) => {
                    throw new Error('Error: ' + err.message)
                  })
                }
    
                return response.json()
              })
              .then((data) => {
                textloader.innerText = 'Processando dados'
    
                setTimeout(() => {
                  textloader.innerText = 'Guardando currículo'
                }, 1000)
    
                setTimeout(() => {
                  textloader.innerText = 'Redicionando para dashboard'
                }, 1500)
    
                setTimeout(() => {
                  window.location.href = '/dashboard/'
                }, 2000)
              })
          })
      })
    })
        </script>
    {% endblock %}
